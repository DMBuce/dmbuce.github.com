occupations = [
"Dragonborn,Cobbler,Awl (as dagger),Shoehorn",
"Dragonborn,Gambler,Club,Dice",
"Dragonborn,Gatekeeper,Dagger,Keys",
"Dragonborn,Hunter,Shortbow,Bear trap",
"Dragonborn,Mariner,Knife (as dagger),Sailcloth (2 yards)",
"Dragonborn,Sailor,Knife (as dagger),Rope (20')",
"Dragonborn,Pirate,Shortsword,Monkey",
"Dragonborn,Pirate,Shortsword,Parrot",
"Dragonborn,Mercenary,Longsword,Hide armor",
"Dragonborn,Smuggler,Sling,Waterproof sack",
"Dwarven,Armorer,Light hammer,Iron helmet",
"Dwarven,Baker,Club,Flour (1 lb.)",
"Dwarven,Blacksmith,Light hammer,Mithril (1 oz.)",
"Dwarven,Blacksmith,Light hammer,Steel tongs",
"Dwarven,Chest-maker,Chisel (as dagger),Wood (10 lbs)",
"Dwarven,Drunk,Liquor bottle (as club),Flask",
"Dwarven,Locksmith,Dagger,Fine tools",
"Dwarven,Miner,Pick (as piercing mace),Lantern",
"Dwarven,Miner,Pick (as piercing mace),Lantern",
"Dwarven,Priest,Quarterstaff,Holy symbol",
"Dwarven,Soldier,Spear,Shield",
"Dwarven,Stonemason,Light hammer,Fine stone (10 lbs)",
"Dwarven,Stonemason,Light hammer,Fine stone (10 lbs)",
"Dwarven,Tax Collector,Longsword,100 cp",
"Dwarven,Woodcutter,Handaxe,Bundle of wood",
"Elven,Artisan,Quarterstaff,Clay (1 lb.)",
"Elven,Barrister,Quill (as dart),Book",
"Elven,Candlemaker,Scissors (as dagger),Candles (20)",
"Elven,Falconer,Dagger,Falcon",
"Elven,Forester,Quarterstaff,Herbs (1 lb.)",
"Elven,Forester,Quarterstaff,Herbs (1 lb.)",
"Elven,Haberdasher,Scissors (as dagger),Fine suits (3 sets)",
"Elven,Healer,Club,Holy water (1 vial)",
"Elven,Herbalist,Club,Herbs (1 lb.)",
"Elven,Scribe,Quill (as dart),Parchment",
"Elven,Noble,Longsword,Gold ring worth 10 gp",
"Elven,Sage,Dagger,Parchment and quill pen",
"Elven,Squire,Longsword,Steel helmet",
"Elven,Tailor,Scissors (as dagger),Fine suit of clothes",
"Elven,Wizard's Apprentice,Dagger,Black grimoire",
"Gnome,Alchemist,Quarterstaff,Oil (1 flask)",
"Gnome,Alchemist,Cudgel (as club),Steel vial",
"Gnome,Animal Trainer,Club,Pony",
"Gnome,Artisan,Quarterstaff,Clay (1 lb.)",
"Gnome,Astrologer,Dagger,Spyglass",
"Gnome,Cartwright,Club,Pushcart",
"Gnome,Costermonger,Knife (as dagger),fruit",
"Gnome,Fortune-Teller,Dagger,Tarot deck",
"Gnome,Glassblower,Light hammer,Glass beads",
"Gnome,Indentured Servant,Quarterstaff,Locket",
"Gnome,Jester,Dart,Silk clothes",
"Gnome,Moneylender,Shortsword,5 gp 10 sp 200 cp",
"Gnome,Outlaw,Shortsword,Leather armor",
"Gnome,Preacher,Club,Holy book",
"Gnome,Shaman,Mace,Herbs (1 lb.)",
"Gnome,Tax Collector,Longsword,100 cp",
"Gnome,Wizard's Apprentice,Dagger,Wand",
"Half-Elf,Beggar,Stick (as club),Begging bowl",
"Half-Elf,Minstrel,Dagger,Ukulele",
"Half-Elf,Orphan,Sling,Rag doll",
"Halfling,Barber,Razor (as dagger),Scissors",
"Halfling,Beekeeper,Quarterstaff,Jar of honey",
"Halfling,Guard,Shortsword,Lantern",
"Halfling,Cheesemaker,Cudgel (as club),Cheese dip",
"Halfling,Chicken butcher,Handaxe,Chicken meat (5 lbs.)",
"Halfling,Cutpurse,Dagger,Small chest",
"Halfling,Dyer,Quarterstaff,Fabric (3 yards)",
"Halfling,Farmer,Pitchfork (as spear),Hen",
"Halfling,Fisherman,Oar (as quarterstaff),Net",
"Halfling,Fisherman,Oar (as quarterstaff),Worms",
"Halfling,Glovemaker,Awl (as dagger),Gloves (4 pairs)",
"Halfling,Gypsy,Sling,Hex doll",
"Halfling,Jeweler,Dagger,Gem worth 20 gp",
"Halfling,Merchant,Dagger,4 gp 14 sp 27 cp",
"Halfling,Ropemaker,Knife (as dagger),Rope (100')",
"Halfling,Trader,Shortsword,20 sp",
"Half-Orc,Beggar,Club,Stinky cheese",
"Half-Orc,Gong Farmer,Trowel (as dagger),Sack of night soil",
"Half-Orc,Orphan,Sling,Rag doll",
"Minotaur,Cooper,Crowbar (as club),Barrel",
"Minotaur,Ditch Digger,Shovel (as quarterstaff),Fine dirt (1 lb.)",
"Minotaur,Farmer,Pitchfork (as spear),Hen",
"Minotaur,Farmer,Pitchfork (as spear),Hen",
"Minotaur,Farmer,Pitchfork (as spear),Hen",
"Minotaur,Farmer,Pitchfork (as spear),Hen",
"Minotaur,Farmhand,Sickle,Seeds",
"Minotaur,Farmhand,Sickle,Seeds",
"Minotaur,Farmhand,Sickle,Seeds",
"Minotaur,Herder,Quarterstaff,Herding dog",
"Minotaur,Hunter,Shortbow,Deer pelt",
"Minotaur,Navigator,Shortbow,Spyglass",
"Minotaur,Ostler,Quarterstaff,Bridle",
"Minotaur,Slave,Club,Strange-looking rock",
"Minotaur,Trapper,Sling,Bear trap",
"Minotaur,Woodcutter,Handaxe,Bundle of wood",
"Goliath,Butcher,Cleaver (as handaxe),Side of beef",
"Goliath,Gravedigger,Shovel (as quarterstaff),Trowel",
"Goliath,Woodcutter,Handaxe,Bundle of wood",
"Tiefling,Confidence Artist,Dagger,Quality cloak",
"Tiefling,Mercenary,Longsword,Hide Armor"
]
consumables = [
	"Acid (1 vial)",
	"Holy water (1 vial)",
	"Ink (1 oz. bottle)",
	"Oil (1 flask)",
	"Parchment (1 sheet)",
	"Perfume (1 vial)",
	"Potion of healing"
]
kits = [
	"Alchemist's supplies",
	"Brewer's supplies",
	"Calligrapher's supplies",
	"Climber's kit",
	"Disguise kit",
	"Forgery kit",
	"Healer's kit",
	"Herbalism kit",
	"Painter's supplies",
	"Poisoner's kit"
]
tools = [
	"Carpenter's tools",
	"Cartographer's tools",
	"Cobbler's tools",
	"Cook's utensils",
	"Glassblower's tools",
	"Jeweler's loupe",
	"Leatherworker's tools",
	"Lockpick's tools",
	"Mason's tools",
	"Potter's tools",
	"Smith's tools",
	"Tinker's tools",
	"Weaver's tools",
	"Woodcarver's tools"
]
containers = [
	"Backpack",
	"Barrel",
	"Basket",
	"Glass bottle",
	"Bucket",
	"Chest",
	"Flask",
	"Iron pot",
	"Jug",
	"Pouch",
	"Sack",
	"Scroll case",
	"Vial",
	"Waterskin"
]
instruments = [
	"Bagpipes",
	"Drum",
	"Flute",
	"Lute",
	"Lyre",
	"Horn",
	"Pan flute",
	"Violin"
]
function genequipment() {
	equipmenttable = [
		randitem(["Bear trap", "Bag of 100 ball bearings"]),
		randitem(["Crowbar", "Grappling hook"]),
		randitem(["Magnifying glass", "Spyglass"]),
		randitem(["Chain (10')", "Rope (50')"]),
		randitem(["10-foot ladder", "10-foot pole"]),
		randitem(["Flint & steel", "Tinderbox"]),
		randitem(["Torch", "Lantern"]),
		randitem(consumables),
		randitem(kits),
		randitem(tools),
		randitem(containers),
		randitem(instruments)
	];
	return randitem(equipmenttable);
}

function randitem(arr) {
	return arr[Math.floor(Math.random()*arr.length)];
}

function genrace(defaultrace) {
	raceroll = 1 + Math.floor( Math.random() * 100 );
	if (1 <= raceroll && raceroll <= 50) {
		race = "Human";
	} else if (51 <= raceroll && raceroll <= 80) {
		race = defaultrace
	} else if (81 <= raceroll && raceroll <= 82) {
		race = "Dwarven";
	} else if (83 <= raceroll && raceroll <= 84) {
		race = "Elven";
	} else if (85 <= raceroll && raceroll <= 86) {
		race = "Gnome";
	} else if (87 <= raceroll && raceroll <= 88) {
		race = "Halfling";
	} else if (89 <= raceroll && raceroll <= 90) {
		race = "Minotaur";
	} else if (91 <= raceroll && raceroll <= 92) {
		race = "Half-Elf";
	} else if (93 <= raceroll && raceroll <= 94) {
		race = "Half-Orc";
	} else if (95 <= raceroll && raceroll <= 96) {
		race = "Dragonborn";
	} else if (97 <= raceroll && raceroll <= 98) {
		race = "Goliath";
	} else if (99 <= raceroll && raceroll <= 100) {
		race = "Tiefling";
	} else {
		race = "Fucking";
	}

	return race;
}

function gencash() {
	// 5d12
	var sum = 0;
	for (i=0; i<5; i++) {
		sum += 1 + Math.floor( Math.random() * 12 );
	}
	return sum + " cp";
}

function genAbility() {
	sum = 0;
	lowest = 0;
	for (i=0; i<4; i++) {
		roll = 1 + Math.floor( Math.random() * 6 ) ;
		sum += roll;
		if (roll < lowest) {
			lowest = roll;
		}
	}
	sum -= lowest;
	return sum;
}

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

function genAbilities() {
	// old implementation, 4d6 drop lowest
	//abilities = [
	//	"Str " + genAbility(),
	//	"Dex " + genAbility(),
	//	"Con " + genAbility(),
	//	"Int " + genAbility(),
	//	"Wis " + genAbility(),
	//	"Cha " + genAbility()
	//];

	//return abilities.join(", ");

	abilities = [ 15, 14, 13, 12, 10, 8 ];
	shuffle(abilities);

	return abilities;
}

function genCharacter() {
	// generate occupation-based info
	var gear = []
	//var occarr = randline("occupations.dat").split(",")
	var occarr = randitem(occupations).split(",");
	var occrace = occarr[0]
	var occupation = occarr[1]
	var weapon = occarr[2]
	var proficiency = weapon.split(" (as")[0]
	gear.push(weapon) // weapon
	gear.push(occarr[3]) // trade goods
	
	// generate race
	race = genrace(occrace)

	// generate random piece of equipment and some coin
	gear.push(genequipment());
	gear.push(gencash());

	// generate abilities, HP
	abilities = genAbilities();
	abilitiesStr = "Str " + abilities[0] +
		", Dex " + abilities[1] +
		", Con " + abilities[2] +
		", Int " + abilities[3] +
		", Wis " + abilities[4] +
		", Cha " + abilities[5];
	var con = Math.floor((abilities[2] - 10) / 2);
	var hproll = 1 + Math.floor( Math.random() * 4 );

	retval = "";
	retval += "Name: ___________________________   Age: ___   Gender: _____\n";
	retval += "Race & Role: " + race + " " + occupation + "\n";
	//retval += "Abilities: Str %s, Dex %s, Con %s, Int %s, Wis %s, Cha %s" % tuple(abilities) + "\n";
	retval += "Abilities: " + abilitiesStr + "\n";
	//retval += "HP: %s (1d4+%s, rolled %s)" % ( max(1, hproll+con), con, hproll ) + "\n";
	//retval += "HP: %s (1d4, rolled %s)" % ( max(1, hproll), hproll ) + "\n";
	retval += "HP: " + Math.max(1, hproll+con) + " (1d4+" + con + ", rolled " + hproll + ")\n";

	//retval += "Gear: %s" + ", ".join(gear);
	retval += "Gear: " + gear.join(", ") + "\n";
	retval += "Proficiency Bonus: +1\n";
	retval += "Proficiencies: " + proficiency + "\n";
	retval += "Personality Traits: ________________________________________\n";
	retval += "                    ________________________________________\n";
	retval += "Ideal:              ________________________________________\n";
	retval += "Flaw:               ________________________________________\n";
	retval += "Bonds:              ________________________________________\n";
	retval += "                    ________________________________________\n";
	return retval;
}

function main() {
	document.getElementsByTagName("code")[0].innerHTML=genCharacter();
	document.getElementsByTagName("code")[1].innerHTML=genCharacter();
	document.getElementsByTagName("code")[2].innerHTML=genCharacter();
	document.getElementsByTagName("code")[3].innerHTML=genCharacter();
}

window.onload = main;

